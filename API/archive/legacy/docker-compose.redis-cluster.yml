services:
  # Redis Cluster Nodes
  redis-node1:
    image: redis:7-alpine
    container_name: redis-node1
    ports:
      - "7001:7001"
      - "17001:17001"
    command: redis-server /etc/redis/redis.conf
    volumes:
      - ./redis-config/redis-node1.conf:/etc/redis/redis.conf
      - redis-node1-data:/data
    networks:
      - redis-cluster-network

  redis-node2:
    image: redis:7-alpine
    container_name: redis-node2
    ports:
      - "7002:7002"
      - "17002:17002"
    command: redis-server /etc/redis/redis.conf
    volumes:
      - ./redis-config/redis-node2.conf:/etc/redis/redis.conf
      - redis-node2-data:/data
    networks:
      - redis-cluster-network

  redis-node3:
    image: redis:7-alpine
    container_name: redis-node3
    ports:
      - "7003:7003"
      - "17003:17003"
    command: redis-server /etc/redis/redis.conf
    volumes:
      - ./redis-config/redis-node3.conf:/etc/redis/redis.conf
      - redis-node3-data:/data
    networks:
      - redis-cluster-network

  redis-node4:
    image: redis:7-alpine
    container_name: redis-node4
    ports:
      - "7004:7004"
      - "17004:17004"
    command: redis-server /etc/redis/redis.conf
    volumes:
      - ./redis-config/redis-node4.conf:/etc/redis/redis.conf
      - redis-node4-data:/data
    networks:
      - redis-cluster-network

  redis-node5:
    image: redis:7-alpine
    container_name: redis-node5
    ports:
      - "7005:7005"
      - "17005:17005"
    command: redis-server /etc/redis/redis.conf
    volumes:
      - ./redis-config/redis-node5.conf:/etc/redis/redis.conf
      - redis-node5-data:/data
    networks:
      - redis-cluster-network

  redis-node6:
    image: redis:7-alpine
    container_name: redis-node6
    ports:
      - "7006:7006"
      - "17006:17006"
    command: redis-server /etc/redis/redis.conf
    volumes:
      - ./redis-config/redis-node6.conf:/etc/redis/redis.conf
      - redis-node6-data:/data
    networks:
      - redis-cluster-network

  # Redis Cluster Setup Container
  redis-cluster-setup:
    image: redis:7-alpine
    container_name: redis-cluster-setup
    depends_on:
      - redis-node1
      - redis-node2
      - redis-node3
      - redis-node4
      - redis-node5
      - redis-node6
    networks:
      - redis-cluster-network
    command: >
      sh -c "sleep 10 &&
             redis-cli --cluster create 
             redis-node1:7001 
             redis-node2:7002 
             redis-node3:7003 
             redis-node4:7004 
             redis-node5:7005 
             redis-node6:7006 
             --cluster-replicas 1 --cluster-yes"
    restart: "no"

  # Redis Commander for cluster management (optional)
  redis-commander:
    image: rediscommander/redis-commander:latest
    container_name: redis-commander
    hostname: redis-commander
    ports:
      - "8081:8081"
    environment:
      - REDIS_HOSTS=cluster:redis-node1:7001,redis-node2:7002,redis-node3:7003
    networks:
      - redis-cluster-network
    depends_on:
      - redis-cluster-setup

volumes:
  redis-node1-data:
  redis-node2-data:
  redis-node3-data:
  redis-node4-data:
  redis-node5-data:
  redis-node6-data:

networks:
  redis-cluster-network:
    driver: bridge